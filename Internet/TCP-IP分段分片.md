



MSS（Max Segment Size）：最大分段长度

MTU（Max Transmit Unit）：IP包最大传输单位

通常来说MTU = 1500Byte，MTU = MSS + TCP头（20Byte）+IP头（20Byte）



MSS的确定是在三次握手的时候协商确定的，取两者的最小值。如果对方没有传MSS，那么将使用默认值（**536**Byte）



**数据在TCP分段，就是为了在IP层不需要分片，同时发生重传的时候只重传分段后的小份数据**。

即使TCP分段了，但是如果传输链路中有路由器等设备有更小的MTU，还需要在进行而二次分片，最后所有的分片数据在接收端进行拼接



**如何避免IP层分片？**

如果能够在发送端就确定好MTU为整条链路的最小值，那么数据在经过中间链路的设备时，就不用二次分片了

整条链路最小的MTU为PMTU（Path MTU）

PMTU值的确定以下方法：

1. 设置IP Header的DF为1，表示数据不分片
2. 当中间设备接收到数据包时，如果DF为1，且IP报文大于自己的MTU，会将数据丢弃，发送ICMP给发送源，同时附上自身的MTU大小
3. 发送端接收到ICMP报文后降低MTU的值，重新发送
4. 经过多次尝试后，即可确定PMTU的值